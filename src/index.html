<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <title>Document</title>
</head>
<body class="body">
    <header class="header">
        <i class="fas fa-calculator"></i> Calories Counter
    </header>    
<div class="wraper">
 <div class="infomrations">
    <div class="infomrationContentText">
        <label for="mealName">Meal</label><br>
        <input type="text" id="mealName" name="mealName" placeholder="Enter meal name..."><br>
        <label for="caloriesNumber">Calories</label>
        <input type="text" id="caloriesNumber" name="caloriesNumber" placeholder="Enter calories number..."><br>
    </div>
    <div class="infomrationButtons">
        <button type="button" id="saveButton">Save</button>
        <button type="button" id="cancelButton">Cancel</button>
    </div>
 <table class="mealTable" id="mealsList">
    <thead>
        <tr>
            <th>Meal-Name <i class="fas fa-utensils"></i> </th>
            <th>Calories <i class="fas fa-fire"></i></th>
        </tr>
    </thead>
    <tbody>
    </tbody>
 </table>
 <div id="totalCalories">Total Calories : 0 Cal</div>
 </div>
</div>
<footer class="footer">
    Let's track your calories <i class="fas fa-hamburger"></i>
</footer>
<script>
    // get the elements from HTML 
    document.getElementById('saveButton').addEventListener("click", save);

    // Save function modified to use localStorage
    function save(){
        var mealName = document.getElementById( 'mealName' ).value;
        var caloriesNumber = document.getElementById( 'caloriesNumber' ).value;
        if (mealName && caloriesNumber){
           var mealsData = JSON.parse(localStorage.getItem("mealsData")) || [];
           mealsData.push({mealName: mealName, caloriesNumber: caloriesNumber}) ;
           localStorage.setItem("mealsData",JSON.stringify(mealsData));

           //Add ing new data in the table
           addToTable(mealName, caloriesNumber);
        } else {
            alert("Please enter both a meal name and the number of calories.");
        }
    }

     // Funktion to update total calories
     function updateTotalCalories() {
        var mealsData = JSON.parse(localStorage.getItem("mealsData"))  || [];
        var totalCalories = mealsData.reduce((acc, meal) => acc + parseInt(meal.caloriesNumber, 10), 0);
        document.getElementById('totalCalories').innerHTML = "Total calories: " + totalCalories + ' Cal'  +  '<i class="fas fa-fire"></i> ';

    }

    //  Function to add data in the table and update calories
    function addToTable(mealName,caloriesNumber){
        var table = document.getElementById('mealsList').getElementsByTagName('tbody')[0];
        //Create a row for each object in array
        var newRow = table.insertRow(-1);
        var cell1 = newRow.insertCell(0);
        var cell2 = newRow.insertCell(1);
         cell1.innerHTML = mealName  +  '<i class="fas fa-utensils"></i> ';
         cell2.innerHTML = '<i class="fas fa-fire"></i> ' + caloriesNumber + " Cal" + '<button class="deleteButton" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button>';
        updateTotalCalories();
    }

    // Load meals from local storage
    function loadmeals() {
        var mealsData = JSON.parse(localStorage.getItem("mealsData")) || [];
        mealsData.forEach(function(meal) {
            addToTable(meal.mealName,meal.caloriesNumber);
        });
        updateTotalCalories();
        
    }

    // Delete row from HTML Table and local storage and  update total calories
    function deleteRow(button) {
        var row = button.parentNode.parentNode;
        var mealNameToDelete = row.cells[0].innerText;
        var mealsData = JSON.parse(localStorage.getItem("mealsData"));
        var filterMeals = mealsData.filter(meal => meal.mealName !== mealNameToDelete);
        localStorage.setItem('mealsData',JSON.stringify(filterMeals));
        row.parentNode.removeChild(row);
        updateTotalCalories();
        
    }

    // Load meals on page load and update total calories
    document.addEventListener("DOMContentLoaded", function() {loadmeals();});

    // Cancel Button Functionality
    document.getElementById('cancelButton').addEventListener("click", cancelForm);

    function cancelForm() {
        location.reload();
    }
</script>   
</body>
</html>